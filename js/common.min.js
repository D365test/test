function modalYesOkClick(e){document.getElementById("modal").style.display="none",modalYesOkCallback&&modalYesOkCallback(e)}function modalNoClick(e){document.getElementById("modal").style.display="none",modalNoCallback&&modalNoCallback(e)}function modalCancelClick(e){document.getElementById("modal").style.display="none",modalCancelCallback&&modalCancelCallback(e)}function modalInputKeyUpEvent(e){if("Enter"===e.key){const t=document.getElementById("modal-yes-ok");if(!t)return;e.preventDefault(),t.click()}else if("Escape"===e.key||"Esc"===e.key){const t=document.getElementById("modal-cancel");if(!t)return;e.preventDefault(),t.click()}}function setupModal(){const e=document.createElement("div");e.id="modal",document.body.appendChild(e);const t=document.createElement("div");t.id="modal-content",e.appendChild(t);const n=document.createElement("p");n.id="modal-text",t.appendChild(n);const o=document.createElement("input");o.id="modal-input",o.type="text",t.appendChild(o),o.addEventListener("keyup",modalInputKeyUpEvent);const l=document.createElement("button");l.type="button",l.id="modal-yes-ok",l.addEventListener("click",modalYesOkClick),t.appendChild(l);const i=document.createElement("button");i.type="button",i.id="modal-no",i.textContent="No",i.addEventListener("click",modalNoClick),t.appendChild(i);const a=document.createElement("button");a.type="button",a.id="modal-cancel",a.textContent="Cancel",a.addEventListener("click",modalCancelClick),t.appendChild(a)}function registerServiceWorker(){navigator.serviceWorker&&(navigator.serviceWorker.addEventListener("controllerchange",function(){window.location.reload()}),navigator.serviceWorker.register("sw.min.js"))}function defaultSettings(){Settings.Highlight1="#CCCC00",Settings.Highlight2="#AA00CC",Settings.Highlight3="#00CCBB",Settings.Menu="Open",Settings.Theme="Light",Settings.Zoom="Fit"}function loadSettings(){defaultSettings();const e=localStorage.getItem(StoreName.Settings);if(e){const t=JSON.parse(e);t&&(t.Filters&&(t.Filters.Brightness&&(Settings.Filters.Brightness=t.Filters.Brightness),t.Filters.Contrast&&(Settings.Filters.Contrast=t.Filters.Contrast),t.Filters.Hue&&(Settings.Filters.Hue=t.Filters.Hue),t.Filters.Saturation&&(Settings.Filters.Saturation=t.Filters.Saturation)),t.Highlight1&&(Settings.Highlight1=t.Highlight1),t.Highlight2&&(Settings.Highlight2=t.Highlight2),t.Highlight3&&(Settings.Highlight3=t.Highlight3),t.Menu&&(Settings.Menu=t.Menu),t.Theme&&(Settings.Theme=t.Theme),t.Zoom&&(Settings.Zoom=t.Zoom))}}function saveSettings(){const e=JSON.stringify(Settings);localStorage.setItem(StoreName.Settings,e)}function setTheme(e){const t=document.getElementsByTagName("html")[0];switch(e){case"Light":t.className="theme-light";break;case"Dark":t.className="theme-dark";break;case"System":default:t.className=window.matchMedia("(prefers-color-scheme: dark)").matches?"theme-dark":"theme-light"}}function themeChange(e){if("System"===Settings.Theme){const t=document.getElementsByTagName("html")[0];t.className=e.matches?"theme-dark":"theme-light"}}function addThemeListener(e){const t=window.matchMedia("(prefers-color-scheme: dark)");"addEventListener"in t&&t.addEventListener("change",e)}function downloadBlob(e,t){const n=document.createElement("a");n.rel="noopener",n.download=e,n.href=URL.createObjectURL(t),setTimeout(()=>URL.revokeObjectURL(n.href),45e3),setTimeout(()=>n.click(),0)}function exportPng(e,t,n){const o=document.createElement("canvas"),l=o.getContext("2d"),i=new Image;i.onload=function(){o.width=i.width,o.height=i.height,n&&(l.fillStyle=n,l.rect(0,0,o.width,o.height),l.fill()),"imageSmoothingQuality"in l&&(l.imageSmoothingQuality="high"),l.drawImage(i,0,0),o.toBlob(function(t){downloadBlob(e,t)})},i.src="data:image/svg+xml;base64,"+btoa(t)}function exportSvg(e,t){const n=new Blob([t],{type:"image/svg+xml"});downloadBlob(e,n)}function createElementFromHtml(e){const t=document.createElement("div");return t.innerHTML=e,t.firstChild}function getStringBetween(e,t,n,o){if(!e)return;if(-1===t)return;const l=e.indexOf(n,t);if(-1===l)return;const i=e.indexOf(o,l);return-1!==i?e.substring(l+1,i):void 0}function getFiltersCss(e,t,n,o){const l=(e/10).toFixed(1),i=(t/10).toFixed(1),a=n+"deg",d=(o/10).toFixed(1);return`brightness(${l}) contrast(${i}) hue-rotate(${a}) saturate(${d})`}function appOffline(){document.getElementById("offline").style.display="block"}function appOnline(){document.getElementById("offline").style.display="none"}function setupOfflineIndicator(){document.getElementById("offline").style.display=navigator.onLine?"none":"block",window.addEventListener("offline",appOffline),window.addEventListener("online",appOnline)}function backOrHome(){1===window.history.length?window.location.href="/":window.history.back()}function modalAlert(e,t){modalYesOkCallback=t,document.getElementById("modal-text").textContent=e,document.getElementById("modal-input").style.display="none",document.getElementById("modal-cancel").style.display="none",document.getElementById("modal-no").style.display="none";const n=document.getElementById("modal-yes-ok");n.textContent="OK",n.style.display="inline-block",document.getElementById("modal").style.display="block",n.focus()}function modalConfirm(e,t,n,o){modalYesOkCallback=t,modalNoCallback=n,modalCancelCallback=o,document.getElementById("modal-text").textContent=e,document.getElementById("modal-input").style.display="none",document.getElementById("modal-no").style.display="inline-block",document.getElementById("modal-cancel").style.display=o?"inline-block":"none";const l=document.getElementById("modal-yes-ok");l.textContent="Yes",l.style.display="inline-block",document.getElementById("modal").style.display="block"}function modalPrompt(e,t,n,o){modalYesOkCallback=n,modalCancelCallback=o,document.getElementById("modal-text").textContent=e,document.getElementById("modal-cancel").style.display="inline-block",document.getElementById("modal-no").style.display="none";const l=document.getElementById("modal-input");l.value=t||"",l.style.display="inline-block";const i=document.getElementById("modal-yes-ok");i.textContent="OK",i.style.display="inline-block",document.getElementById("modal").style.display="block",l.focus()}function getModalInputText(){return document.getElementById("modal-input").value}function isEmbedded(){try{return window.self!==window.top}catch{return!0}}const StoreName={Flags:"flags",Settings:"settings"},Mouse={Button:{Left:0,Middle:1,Right:2,Back:3,Forward:4},Buttons:{Left:1,Right:2,Middle:4,Back:8,Forward:16},Which:{Left:1,Middle:2,Right:3}},Settings={Filters:{Brightness:10,Contrast:10,Hue:0,Saturation:10},Highlight1:"",Highlight2:"",Highlight3:"",Menu:"",Theme:"",Zoom:""},isIOS=window.navigator.userAgent.includes("iPad")||window.navigator.userAgent.includes("iPhone");let modalYesOkCallback=void 0,modalNoCallback=void 0,modalCancelCallback=void 0;registerServiceWorker(),loadSettings(),setTheme(Settings.Theme),addThemeListener(themeChange);